close all; 
clear all;

SS=csvread('Yall.csv',1,0); % Case A: Loading-unloading data from 1 to 6 kN in 1 kN increments
DD=csvread('Dall.csv',1,0); % Case B: Loading-unloading data from 1.5 to 5.5 kN in 1 kN increments
AA=csvread('All2500.csv',1,0); % Case C: Load to and unload from 2.5 kN
BB=csvread('All5kN.csv',1,0); % Case D: Load to and unload from 5 kN
CC=csvread('All10kN.csv',1,0); % Case E: Load to and unload from 10 kN


Load=SS(:,2);Strain=SS(:,3); % Load and Strain from Case A
LD=DD(:,2);SD=DD(:,3); % Load and Strain from Case B
LA=AA(:,1);SA=AA(:,2); %"" Case C
LB=BB(:,1);SB=BB(:,2); %"" Case D
LC=CC(:,1);SC=CC(:,2); % "" Case E

% Offsets
S1=-.041; % Offset for Case E
S2=-.047; % offset for Case D
S3=-.0366; % offset for Case B

figure
hold on
plot(-1.*Strain,-1.*Load,'k');
plot(-1.*(SD+S3),-1.*LD,'r+')
plot(-1.*SA,-1.*LA,'b')
plot(-1.*(SB+S2),-1.*LB,'m')
plot(-1.*(SC+S1),-1.*LC,'g')

hold off
xlabel('Deformation (mm)','FontSize',16)
ylabel('Load (kN)','FontSize',16)
legend('Case A','Case B','Case C','Case D','Case E')
grid on
set(gca,'FontSize',14)

% I need to get more data from this case
case_B_strain = -1.*(SD+S3);
case_B_force = -1.*LD;

% Look up the gap
difference = diff(case_B_force);
[max,new_start] = max(abs(difference));

case_B_1 = case_B_strain(1:
plot(case_B_strain(new_start+1:end),case_B_force(new_start+1:end));

Experimental_data = cell(5,1);
Experimental_data{1} = [-1.*Strain, -1.*Load];
Experimental_data{2} = [case_B_strain, case_B_force];
Experimental_data{3} = [-1.*SA, -1.*LA];
Experimental_data{4} = [-1.*(SB+S2), -1.*LB];
Experimental_data{5} = [-1.*(SC+S1), -1.*LC];

plotting = 1;

cd('/home/miguel/Dropbox/AdaptiveTopOpt/QuadBeads/Chain/Curve fitting/')
load('parameters.mat')
cd('/home/miguel/Dropbox/AdaptiveTopOpt/QuadBeads/Chain/Curve fitting/Data')
 
for j=2:2
    [delta, alphaMax, force,...
        new_delta,new_force, new_alphaMax, ...
        alphaMaxUnloading,delta_unloaded,...
        delta_plastic_regime, force_plastic_regime,...
        delta_elastic_regime, force_elastic_regime, alphaMax_elastic_regime,...
        smoothed_delta, smoothed_force] = validate_data(plotting,Experimental_data{j},j);



    Force_Raj_fit = contact_law(all_parameters,delta,alphaMax);

    figure 
    plot(delta,Force_Raj_fit);
    hold on
    plot(smoothed_delta,smoothed_force,'r-');
    xlabel('Strain')
    ylabel('Force')
    title('Comparing contact laws after fitting')
end


%xlim([0 .4])
%ylim([0 6])
